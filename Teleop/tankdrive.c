#pragma config(Sensor, S1,     ,               sensorI2CCustom)
#pragma config(Sensor, S2,     ,               sensorI2CCustom)
#pragma config(Sensor, S3,     ,               sensorI2CCustom)
#pragma config(Sensor, S4,     ,               sensorTouch)
//*!!Code automatically generated by 'ROBOTC' configuration wizard               !!*//

#include "../libraries/I2C.h"
#include "../libraries/Servos.h"
#include "../libraries/Arm.c"
#include "JoystickDriver.c"

/*

	IMPORTANT: DESIGNED FOR VARSITY'S JARVIS CHASSIS.

	TODO: add support for the rotator servo

*/

// program parameters
const int deadband = 8;
const int baseJoyModifier = 100/128;
const int baseArmModifier = 100/128;

float userJoyModifier = 1;
float userArmModifier = 1; // this doesn't do anything meaningful yet
int rightpower, leftpower, armpower, servopower = 0;

task main()
{
	while(true)
	{
		// switch the drive multiplier mode
		if (joy1Btn(3) == 1) {
			if (userJoyModifier == 100/128) userJoyModifier = 0.5;
			if (userJoyModifier == 0.5) userJoyModifier = 100/128;
		}

		rightpower = joystick.joy1_y2 / baseJoyModifier * userJoyModifier;
		leftpower = joystick.joy1_y1 / baseJoyModifier * userJoyModifier;
		armpower = -joystick.joy2_y1 / baseArmModifier * userArmModifier;

		if (joy2Btn(3) == 1)
		{
			nxtDisplayString(1, "herro");
			servopower = 0;
		}
		else
		{
			servopower = 255;
		}

		// deadbands
		if (abs(rightpower) < deadband)
		{
			rightpower = 0;
		}
		if (abs(leftpower) < deadband)
		{
			leftpower = 0;
		}
		if (abs(armpower) < deadband)
		{
			armpower = 0;
		}
		if (abs(servopower) < deadband)
		{
			servopower = 0;
		}

		Servos_SetPosition(S1, 3, 1, servopower);
		I2C_SetMotorSpeed(S1, 2, 1, rightpower);
		I2C_SetMotorSpeed(S1, 2, 2, -leftpower);

		Arm_SetSpeed(armpower);
		Arm_Update();

		Sleep(10);
	}
}
